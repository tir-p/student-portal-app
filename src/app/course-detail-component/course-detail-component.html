<div class="container py-4">
  @if (loading()) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } @else if (course()) {
    <!-- Back Button -->
    <div class="mb-3">
      <a routerLink="/courses" class="btn btn-outline-secondary btn-sm">
        <i class="fas fa-arrow-left me-2"></i>Back to Courses
      </a>
    </div>

    <!-- Course Header -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-md-8">
                <div class="d-flex align-items-center mb-2">
                  <h2 class="mb-0 me-3">{{ course()!.name }}</h2>
                  <span class="badge bg-primary">{{ course()!.code | courseCode }}</span>
                </div>
                <p class="text-muted mb-2">{{ course()!.description }}</p>
                <div class="d-flex gap-3">
                  <span class="text-muted">
                    <i class="fas fa-book me-2"></i>{{ course()!.credits | creditHours }}
                  </span>
                  <span class="text-muted">
                    <i class="fas fa-calendar me-2"></i>{{ course()!.semester | semester }}
                  </span>
                  <span class="badge" 
                    [ngClass]="{
                      'bg-success': course()!.status === 'active',
                      'bg-secondary': course()!.status === 'completed',
                      'bg-info': course()!.status === 'upcoming',
                      'bg-danger': course()!.status === 'cancelled'
                    }">
                    {{ course()!.status | titlecase }}
                  </span>
                </div>
              </div>
              <div class="col-md-4 text-md-end mt-3 mt-md-0">
                @if (getCourseGrade(); as grade) {
                  <div class="grade-display">
                    <h1 class="display-3 mb-0" [ngClass]="grade.letterGrade | gradeColor">
                      {{ grade.letterGrade }}
                    </h1>
                    <p class="text-muted">Current Grade</p>
                    <small class="text-muted">{{ grade.totalScore | number:'1.1-1' }}%</small>
                  </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <!-- Left Column -->
      <div class="col-lg-8">
        <!-- Assignments Section -->
        @if (getCourseGrade(); as grade) {
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white py-3">
              <h5 class="mb-0">
                <i class="fas fa-tasks me-2"></i>Assignments & Assessments
              </h5>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-hover mb-0">
                  <thead class="table-light">
                    <tr>
                      <th>Assignment</th>
                      <th class="text-center">Weight</th>
                      <th class="text-center">Score</th>
                      <th class="text-center">Status</th>
                      <th>Due Date</th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (assignment of grade.assignments; track assignment.id) {
                      <tr>
                        <td>
                          <strong>{{ assignment.name }}</strong>
                          @if (assignment.feedback) {
                            <br>
                            <small class="text-muted">
                              <i class="fas fa-comment me-1"></i>{{ assignment.feedback }}
                            </small>
                          }
                        </td>
                        <td class="text-center">{{ assignment.weight }}%</td>
                        <td class="text-center">
                          @if (assignment.status === 'graded') {
                            <strong>{{ assignment.earnedScore }}/{{ assignment.maxScore }}</strong>
                          } @else {
                            <span class="text-muted">-</span>
                          }
                        </td>
                        <td class="text-center">
                          <span class="badge"
                            [ngClass]="{
                              'bg-secondary': assignment.status === 'pending',
                              'bg-info': assignment.status === 'submitted',
                              'bg-success': assignment.status === 'graded',
                              'bg-warning': assignment.status === 'late',
                              'bg-danger': assignment.status === 'missing'
                            }">
                            {{ assignment.status | titlecase }}
                          </span>
                        </td>
                        <td>
                          <small>{{ assignment.dueDate | date:'MMM dd, yyyy' }}</small>
                          @if (assignment.status === 'pending') {
                            <br>
                            <small class="text-warning">
                              {{ assignment.dueDate | timeRemaining }}
                            </small>
                          }
                        </td>
                      </tr>
                    }
                    
                    <!-- Exam Scores -->
                    @if (grade.midtermScore) {
                      <tr class="table-light">
                        <td><strong>Midterm Exam</strong></td>
                        <td class="text-center">20%</td>
                        <td class="text-center"><strong>{{ grade.midtermScore }}/100</strong></td>
                        <td class="text-center">
                          <span class="badge bg-success">Graded</span>
                        </td>
                        <td><small>Completed</small></td>
                      </tr>
                    }
                    @if (grade.finalScore) {
                      <tr class="table-light">
                        <td><strong>Final Exam</strong></td>
                        <td class="text-center">20%</td>
                        <td class="text-center"><strong>{{ grade.finalScore }}/100</strong></td>
                        <td class="text-center">
                          <span class="badge bg-success">Graded</span>
                        </td>
                        <td><small>Completed</small></td>
                      </tr>
                    }
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        }

        <!-- Class Schedule -->
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white py-3">
            <h5 class="mb-0">
              <i class="fas fa-clock me-2"></i>Class Schedule
            </h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              @for (schedule of course()!.schedule; track schedule.day) {
                <div class="col-md-6">
                  <div class="schedule-card p-3 border rounded">
                    <div class="d-flex align-items-center mb-2">
                      <div class="schedule-icon me-3">
                        <i class="fas fa-calendar-day"></i>
                      </div>
                      <div>
                        <h6 class="mb-0">{{ schedule.day }}</h6>
                        <small class="text-muted">{{ schedule.startTime }} - {{ schedule.endTime }}</small>
                      </div>
                    </div>
                    <p class="mb-0 text-muted">
                      <i class="fas fa-map-marker-alt me-2"></i>{{ schedule.location }}
                    </p>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="col-lg-4">
        <!-- Instructor Information -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-white py-3">
            <h5 class="mb-0">
              <i class="fas fa-user-tie me-2"></i>Instructor
            </h5>
          </div>
          <div class="card-body">
            <div class="text-center mb-3">
              <div class="instructor-avatar mx-auto mb-3">
                <i class="fas fa-user-circle fs-1 text-primary"></i>
              </div>
              <h5 class="mb-1">{{ course()!.instructor.name }}</h5>
              <p class="text-muted mb-0">{{ course()!.instructor.department }}</p>
            </div>
            <hr>
            <div class="info-list">
              <div class="info-item mb-3">
                <small class="text-muted d-block">Email</small>
                <a [href]="'mailto:' + course()!.instructor.email" class="text-decoration-none">
                  <i class="fas fa-envelope me-2"></i>{{ course()!.instructor.email }}
                </a>
              </div>
              @if (course()!.instructor.officeHours) {
                <div class="info-item mb-3">
                  <small class="text-muted d-block">Office Hours</small>
                  <p class="mb-0">
                    <i class="fas fa-clock me-2"></i>{{ course()!.instructor.officeHours }}
                  </p>
                </div>
              }
            </div>
            <div class="d-grid gap-2 mt-3">
              <button class="btn btn-outline-primary btn-sm">
                <i class="fas fa-paper-plane me-2"></i>Send Message
              </button>
            </div>
          </div>
        </div>

        <!-- Course Information -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-header bg-white py-3">
            <h5 class="mb-0">
              <i class="fas fa-info-circle me-2"></i>Course Info
            </h5>
          </div>
          <div class="card-body">
            <div class="info-list">
              <div class="info-item mb-3">
                <small class="text-muted d-block">Credits</small>
                <p class="mb-0">
                  <i class="fas fa-graduation-cap me-2"></i>{{ course()!.credits | creditHours }}
                </p>
              </div>
              <div class="info-item mb-3">
                <small class="text-muted d-block">Semester</small>
                <p class="mb-0">
                  <i class="fas fa-calendar-alt me-2"></i>{{ course()!.semester | semester }}
                </p>
              </div>
              <div class="info-item mb-3">
                <small class="text-muted d-block">Enrollment</small>
                <p class="mb-0">
                  <i class="fas fa-users me-2"></i>
                  {{ course()!.enrolledStudents }}/{{ course()!.maxCapacity }} students
                </p>
                <div class="progress mt-2" style="height: 6px;">
                  <div 
                    class="progress-bar bg-primary" 
                    role="progressbar" 
                    [style.width.%]="(course()!.enrolledStudents / course()!.maxCapacity) * 100"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white py-3">
            <h5 class="mb-0">
              <i class="fas fa-bolt me-2"></i>Quick Actions
            </h5>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              <button class="btn btn-outline-primary btn-sm">
                <i class="fas fa-file-download me-2"></i>Download Syllabus
              </button>
              <button class="btn btn-outline-primary btn-sm">
                <i class="fas fa-book-open me-2"></i>Course Materials
              </button>
              <button class="btn btn-outline-primary btn-sm" routerLink="/attendance">
                <i class="fas fa-calendar-check me-2"></i>View Attendance
              </button>
              <button class="btn btn-outline-danger btn-sm">
                <i class="fas fa-sign-out-alt me-2"></i>Drop Course
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div class="card border-0 shadow-sm">
      <div class="card-body text-center py-5">
        <i class="fas fa-exclamation-circle fs-1 text-muted mb-3"></i>
        <h5 class="text-muted">Course not found</h5>
        <p class="text-muted mb-4">The course you're looking for doesn't exist or has been removed.</p>
        <a routerLink="/courses" class="btn btn-primary">
          <i class="fas fa-arrow-left me-2"></i>Back to Courses
        </a>
      </div>
    </div>
  }
</div>