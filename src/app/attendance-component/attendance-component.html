<div class="container py-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-sm">
        <div class="card-body">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h2 class="mb-2">Attendance Tracking</h2>
              <p class="text-muted mb-0">Monitor your class attendance across all courses</p>
            </div>
            <div class="col-md-4 text-md-end">
              <h1 class="display-4 mb-0">{{ overallAttendance() | number:'1.1-1' }}%</h1>
              <p class="text-muted">Overall Attendance</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  @if (loading()) {
    <div class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } @else if (error()) {
    <div class="alert alert-danger" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i>
      {{ error() }}
    </div>
  } @else {
    <!-- Attendance Cards -->
    <div class="row g-4">
      @for (attendance of attendanceRecords(); track attendance.id) {
        <div class="col-lg-6">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <h5 class="card-title mb-1">{{ attendance.courseCode }}</h5>
                  <h6 class="text-muted">{{ attendance.courseName }}</h6>
                </div>
                <span [class]="(attendance.attendancePercentage | attendanceStatus).class">
                  {{ (attendance.attendancePercentage | attendanceStatus).label }}
                </span>
              </div>

              <!-- Attendance Stats -->
              <div class="row text-center mb-3">
                <div class="col-4">
                  <div class="border-end">
                    <h4 class="mb-0">{{ attendance.totalClasses }}</h4>
                    <small class="text-muted">Total Classes</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="border-end">
                    <h4 class="mb-0 text-success">{{ attendance.attendedClasses }}</h4>
                    <small class="text-muted">Attended</small>
                  </div>
                </div>
                <div class="col-4">
                  <h4 class="mb-0 text-danger">{{ attendance.totalClasses - attendance.attendedClasses }}</h4>
                  <small class="text-muted">Missed</small>
                </div>
              </div>

              <!-- Progress Bar -->
              <div class="mb-3">
                <div class="d-flex justify-content-between mb-1">
                  <small class="text-muted">Attendance Rate</small>
                  <small class="fw-bold" [ngClass]="getStatusClass(attendance.attendancePercentage)">
                    {{ attendance.attendancePercentage | number:'1.1-1' }}%
                  </small>
                </div>
                <div class="progress" style="height: 10px;">
                  <div 
                    class="progress-bar"
                    [ngClass]="{
                      'bg-success': attendance.attendancePercentage >= 75,
                      'bg-warning': attendance.attendancePercentage >= 65 && attendance.attendancePercentage < 75,
                      'bg-danger': attendance.attendancePercentage < 65
                    }"
                    role="progressbar" 
                    [style.width.%]="attendance.attendancePercentage"
                  ></div>
                </div>
              </div>

              <!-- Warning Message -->
              @if (attendance.status === 'critical') {
                <div class="alert alert-danger py-2 mb-3" role="alert">
                  <small>
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Critical: Attendance below 65%! Risk of academic penalty.
                  </small>
                </div>
              } @else if (attendance.status === 'warning') {
                <div class="alert alert-warning py-2 mb-3" role="alert">
                  <small>
                    <i class="fas fa-exclamation-circle me-2"></i>
                    Warning: Attendance below 75%. Improve to avoid issues.
                  </small>
                </div>
              }

              <!-- Recent Records -->
              <div class="mt-3">
                <h6 class="mb-2">Recent Records</h6>
                <div class="list-group list-group-flush">
                  @for (record of attendance.records.slice(-5).reverse(); track record.id) {
                    <div class="list-group-item px-0 py-2">
                      <div class="d-flex justify-content-between align-items-center">
                        <div>
                          <small class="text-muted">{{ record.date | date:'MMM dd, yyyy' }}</small>
                          <span class="ms-2 badge" 
                            [ngClass]="{
                              'bg-success': record.status === 'present',
                              'bg-danger': record.status === 'absent',
                              'bg-warning': record.status === 'late',
                              'bg-info': record.status === 'excused'
                            }">
                            {{ record.status | titlecase }}
                          </span>
                        </div>
                        <small class="text-muted">
                          <i class="fas fa-book me-1"></i>{{ record.classType | titlecase }}
                        </small>
                      </div>
                      @if (record.remarks) {
                        <small class="text-muted d-block mt-1">{{ record.remarks }}</small>
                      }
                    </div>
                  }
                </div>
              </div>
            </div>
          </div>
        </div>
      } @empty {
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center py-5">
              <i class="fas fa-calendar-times fs-1 text-muted mb-3"></i>
              <h5 class="text-muted">No attendance records found</h5>
              <p class="text-muted">Attendance data will appear here once classes begin.</p>
            </div>
          </div>
        </div>
      }
    </div>
  }
</div>